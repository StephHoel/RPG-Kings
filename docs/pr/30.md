# Deleção segura de save e dados relacionados

Link da issue relacionada: #14

## Versão (opcional)

- Versão (SemVer): 0.1.10
- Data: 2025-11-29

---

## Descrição (resumo)

- O que foi feito: Implementa a deleção em cascata de um `save` na camada de repositório (`repo`), garantindo que registros dependentes (ex.: `sheets`, `stats`, `inventories`, `xp_records`) sejam removidos de forma atômica dentro de uma transação Dexie. O serviço de deleção passou a utilizar esse método e o hook de UI foi simplificado para apenas chamar o serviço. Foram adicionados testes unitários cobrindo o comportamento e documentada a política de deleção em cascata.
- Por que: para garantir consistência dos dados, evitar registros órfãos e centralizar a lógica de remoção na camada que tem acesso ao DB, mantendo o fluxo arquitetural `ui > hook > service > repo > db`.

---

## Destaques

- Adicionado `deleteSaveCascade(id: string)` em `src/infra/repositories/saves.repo.ts` que executa a remoção atômica dos stores relacionados.
- Atualizado `src/services/save/deleteSave.service.ts` para usar a nova função de cascata.
- Simplificado `src/ui/hooks/save/useDeleteSave.ts` para chamar apenas o serviço de deleção.
- Adicionado teste unitário `tests/unit/repos/deleteSaveCascade.repo.test.ts` cobrindo remoção em cascata.
- Documentação atualizada com política de deleção em cascata e comandos oficiais de teste.

---

## Breaking Changes

- Não há breaking changes esperados. A API pública dos serviços se mantém compatível; a alteração é interna à camada de repositório/serviço.

---

## Checklist

- [x] Testes adicionados/atualizados
- [x] Documentação atualizada (`.github/agents/Ajudante.agent.md`)
- [x] `package.json` atualizado (se aplicável)
- [x] Linked issue (ex.: `Closes #14`)

---

Observações para revisão:

- Verificar a implementação da transação (`db.transaction('rw', [...stores], async () => { ... })`) e a cobertura dos testes unitários.
- Durante os testes locais podem aparecer warnings de migrações/Dexie que são esperados no ambiente de teste; não impactam a validade das alterações.

Branch: `feat/14-delecao-em-cascata`
